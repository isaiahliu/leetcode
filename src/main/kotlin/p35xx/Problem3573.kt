package p35xx

import util.expect

fun main() {
    class Solution {
        fun maximumProfit(prices: IntArray, k: Int): Long {
            val cache = Array(prices.size) {
                LongArray(k + 1) { -1 }
            }

            var min = prices[prices.lastIndex]
            var max = prices[prices.lastIndex]

            for (t in prices.lastIndex - 1 downTo 0) {
                min = minOf(min, prices[t])
                max = maxOf(max, prices[t])

                cache[t][1] = (max - min).toLong()
            }


            fun dfs(from: Int, count1: Int): Long {
                val count = minOf(count1, (prices.size - from) / 2)
                return when {
                    cache[from][count] >= 0 -> cache[from][count]

                    else -> {
                        var result = dfs(from, count - 1)

                        var min = prices[from]
                        var max = prices[from]
                        var diff = 0L
                        for (m in from + 1 until prices.lastIndex - 1) {
                            min = minOf(min, prices[m])
                            max = maxOf(max, prices[m])

                            if (diff < max - min) {
                                diff = (max - min).toLong()
                                result = maxOf(result, dfs(m + 1, count - 1) + max - min)
                            }
                        }

                        cache[from][count] = result
                        result
                    }
                }
            }

            return dfs(0, k)
        }
    }

    expect {
        Solution().maximumProfit(
            intArrayOf(
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1,
                1,
                1000000000,
                1000000000,
                1
            ), 500
        )
    }
}
