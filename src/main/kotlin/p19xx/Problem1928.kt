package p19xx

import java.util.*
import kotlin.system.measureTimeMillis

fun main() {
    class Solution {
        fun minCost(maxTime: Int, edges: Array<IntArray>, passingFees: IntArray): Int {
            val children = Array(passingFees.size) {
                hashMapOf<Int, Int>()
            }

            edges.forEach { (from, to, time) ->
                children[from][to] = (children[from][to] ?: Int.MAX_VALUE).coerceAtMost(time)
                children[to][from] = (children[to][from] ?: Int.MAX_VALUE).coerceAtMost(time)
            }

            //cost to time to index
            val queue = PriorityQueue<Pair<Pair<Int, Int>, Int>>(compareBy { it.first.first })
            queue.add(passingFees[0] to 0 to 0)

            val methods = Array(passingFees.size) {
                TreeMap<Int, Int>().also {
                    it[-1] = Int.MAX_VALUE
                }
            }

            while (queue.isNotEmpty()) {
                val (p, index) = queue.poll()
                val (cost, time) = p

                if (index == passingFees.lastIndex) {
                    return cost
                }

                methods[index].floorEntry(cost)?.takeIf { it.value > time }?.also {
                    while (true) {
                        methods[index].ceilingEntry(cost)?.takeIf { it.value >= time }?.also {
                            methods[index].remove(it.key)
                        } ?: break
                    }

                    methods[index][cost] = time

                    children[index].forEach { (to, t) ->
                        val newTime = time + t
                        if (newTime <= maxTime) {
                            val newCost = cost + passingFees[to]

                            queue.add(newCost to newTime to to)
                        }
                    }
                }
            }

            return -1
        }
    }

    measureTimeMillis {
        Solution().minCost(
            24, arrayOf(
                intArrayOf(27, 8, 37),
                intArrayOf(9, 36, 15),
                intArrayOf(15, 8, 13),
                intArrayOf(30, 8, 12),
                intArrayOf(21, 4, 30),
                intArrayOf(22, 33, 46),
                intArrayOf(27, 29, 10),
                intArrayOf(35, 32, 35),
                intArrayOf(22, 39, 34),
                intArrayOf(9, 45, 14),
                intArrayOf(26, 21, 44),
                intArrayOf(13, 36, 14),
                intArrayOf(3, 49, 20),
                intArrayOf(28, 44, 11),
                intArrayOf(15, 30, 5),
                intArrayOf(26, 49, 36),
                intArrayOf(8, 40, 3),
                intArrayOf(28, 25, 1),
                intArrayOf(41, 46, 48),
                intArrayOf(38, 24, 8),
                intArrayOf(30, 7, 39),
                intArrayOf(14, 3, 36),
                intArrayOf(2, 19, 21),
                intArrayOf(12, 39, 37),
                intArrayOf(16, 3, 47),
                intArrayOf(11, 31, 22),
                intArrayOf(38, 25, 34),
                intArrayOf(42, 6, 47),
                intArrayOf(14, 20, 21),
                intArrayOf(33, 8, 35),
                intArrayOf(17, 5, 2),
                intArrayOf(36, 19, 3),
                intArrayOf(47, 28, 40),
                intArrayOf(37, 33, 35),
                intArrayOf(24, 47, 40),
                intArrayOf(7, 15, 26),
                intArrayOf(8, 0, 13),
                intArrayOf(40, 34, 10),
                intArrayOf(25, 3, 19),
                intArrayOf(44, 9, 5),
                intArrayOf(16, 6, 22),
                intArrayOf(34, 35, 39),
                intArrayOf(24, 5, 2),
                intArrayOf(3, 22, 16),
                intArrayOf(27, 24, 3),
                intArrayOf(35, 5, 29),
                intArrayOf(5, 48, 49),
                intArrayOf(12, 22, 8),
                intArrayOf(45, 15, 36),
                intArrayOf(2, 35, 36),
                intArrayOf(24, 18, 14),
                intArrayOf(24, 49, 3),
                intArrayOf(49, 20, 38),
                intArrayOf(41, 24, 25),
                intArrayOf(18, 49, 15),
                intArrayOf(24, 4, 23),
                intArrayOf(16, 0, 22),
                intArrayOf(41, 46, 34),
                intArrayOf(7, 12, 31),
                intArrayOf(9, 5, 13),
                intArrayOf(19, 44, 49),
                intArrayOf(8, 25, 8),
                intArrayOf(24, 7, 9),
                intArrayOf(4, 33, 38),
                intArrayOf(49, 19, 17),
                intArrayOf(11, 31, 19),
                intArrayOf(29, 40, 31),
                intArrayOf(30, 29, 10),
                intArrayOf(25, 20, 31),
                intArrayOf(38, 28, 18),
                intArrayOf(21, 29, 18),
                intArrayOf(18, 46, 19),
                intArrayOf(43, 33, 43),
                intArrayOf(22, 15, 19),
                intArrayOf(26, 44, 21),
                intArrayOf(9, 13, 13),
                intArrayOf(0, 20, 9),
                intArrayOf(11, 9, 12),
                intArrayOf(22, 39, 43),
                intArrayOf(43, 47, 29),
                intArrayOf(12, 10, 34),
                intArrayOf(49, 36, 41),
                intArrayOf(39, 48, 11),
                intArrayOf(9, 27, 13),
                intArrayOf(9, 8, 30),
                intArrayOf(18, 49, 39),
                intArrayOf(18, 33, 40),
                intArrayOf(35, 22, 28),
                intArrayOf(8, 6, 24),
                intArrayOf(14, 41, 10),
                intArrayOf(21, 34, 20),
                intArrayOf(37, 6, 2),
                intArrayOf(20, 7, 24),
                intArrayOf(11, 10, 29),
                intArrayOf(12, 35, 2),
                intArrayOf(22, 41, 9),
                intArrayOf(47, 1, 16),
                intArrayOf(29, 2, 38),
                intArrayOf(46, 40, 29),
                intArrayOf(32, 47, 10),
                intArrayOf(39, 33, 23),
                intArrayOf(24, 17, 3),
                intArrayOf(27, 47, 3),
                intArrayOf(28, 10, 37),
                intArrayOf(42, 48, 46),
                intArrayOf(48, 24, 20),
                intArrayOf(48, 44, 16),
                intArrayOf(34, 47, 28),
                intArrayOf(48, 34, 3),
                intArrayOf(12, 23, 39),
                intArrayOf(13, 4, 44),
                intArrayOf(0, 33, 39),
                intArrayOf(21, 3, 3),
                intArrayOf(45, 14, 38),
                intArrayOf(36, 9, 18),
                intArrayOf(19, 3, 37),
                intArrayOf(6, 2, 27),
                intArrayOf(29, 40, 37),
                intArrayOf(37, 42, 44),
                intArrayOf(10, 14, 10),
                intArrayOf(15, 17, 21),
                intArrayOf(35, 12, 14),
                intArrayOf(46, 10, 18),
                intArrayOf(41, 0, 47),
                intArrayOf(46, 28, 42),
                intArrayOf(13, 19, 25),
                intArrayOf(42, 11, 30),
                intArrayOf(27, 14, 47),
                intArrayOf(47, 30, 36),
                intArrayOf(13, 43, 4),
                intArrayOf(29, 3, 14),
                intArrayOf(36, 16, 40),
                intArrayOf(1, 0, 18),
                intArrayOf(18, 6, 1),
                intArrayOf(18, 0, 20),
                intArrayOf(24, 38, 37),
                intArrayOf(25, 48, 12),
                intArrayOf(34, 12, 27),
                intArrayOf(8, 42, 12),
                intArrayOf(40, 4, 5),
                intArrayOf(33, 15, 13),
                intArrayOf(40, 14, 43),
                intArrayOf(17, 23, 25),
                intArrayOf(7, 3, 12),
                intArrayOf(41, 42, 32),
                intArrayOf(7, 11, 4),
                intArrayOf(33, 23, 36),
                intArrayOf(3, 25, 7),
                intArrayOf(20, 22, 29),
                intArrayOf(19, 18, 21),
                intArrayOf(6, 34, 34),
                intArrayOf(21, 31, 9),
                intArrayOf(48, 16, 22),
                intArrayOf(14, 0, 7),
                intArrayOf(20, 10, 24),
                intArrayOf(5, 6, 44),
                intArrayOf(24, 48, 27),
                intArrayOf(4, 39, 1),
                intArrayOf(16, 41, 43),
                intArrayOf(2, 27, 1),
                intArrayOf(0, 7, 13),
                intArrayOf(6, 2, 30),
                intArrayOf(40, 43, 15),
                intArrayOf(35, 39, 44),
                intArrayOf(45, 47, 37),
                intArrayOf(29, 28, 40),
                intArrayOf(27, 41, 38),
                intArrayOf(43, 48, 49),
                intArrayOf(23, 3, 34),
                intArrayOf(48, 43, 10),
                intArrayOf(7, 23, 17),
                intArrayOf(4, 9, 44),
                intArrayOf(22, 41, 29),
                intArrayOf(42, 13, 33),
                intArrayOf(40, 7, 24),
                intArrayOf(23, 21, 8),
                intArrayOf(4, 3, 27),
                intArrayOf(7, 22, 42),
                intArrayOf(12, 26, 3),
                intArrayOf(38, 23, 3),
                intArrayOf(14, 8, 16),
                intArrayOf(35, 26, 31),
                intArrayOf(40, 7, 9),
                intArrayOf(4, 13, 4),
                intArrayOf(48, 47, 27),
                intArrayOf(18, 27, 2),
                intArrayOf(20, 30, 27),
                intArrayOf(7, 32, 32),
                intArrayOf(12, 5, 25),
                intArrayOf(47, 41, 25),
                intArrayOf(49, 27, 37),
                intArrayOf(9, 43, 4),
                intArrayOf(47, 2, 15),
                intArrayOf(14, 47, 24),
                intArrayOf(28, 10, 4),
                intArrayOf(36, 2, 11),
                intArrayOf(36, 25, 14),
                intArrayOf(17, 5, 38),
                intArrayOf(26, 20, 17),
                intArrayOf(25, 40, 5),
                intArrayOf(26, 12, 30),
                intArrayOf(29, 19, 24),
                intArrayOf(47, 16, 15),
                intArrayOf(4, 19, 27),
                intArrayOf(8, 44, 1),
                intArrayOf(13, 41, 44),
                intArrayOf(6, 20, 28),
                intArrayOf(44, 13, 35),
                intArrayOf(11, 39, 25),
                intArrayOf(6, 8, 19),
                intArrayOf(16, 30, 15),
                intArrayOf(36, 43, 25),
                intArrayOf(43, 2, 9),
                intArrayOf(34, 42, 46),
                intArrayOf(13, 18, 45),
                intArrayOf(48, 27, 36),
                intArrayOf(16, 13, 9),
                intArrayOf(48, 27, 9),
                intArrayOf(49, 18, 6),
                intArrayOf(41, 5, 50),
                intArrayOf(1, 20, 12),
                intArrayOf(27, 13, 40),
                intArrayOf(1, 0, 30),
                intArrayOf(48, 28, 14),
                intArrayOf(20, 29, 15),
                intArrayOf(14, 23, 27),
                intArrayOf(14, 23, 4),
                intArrayOf(3, 48, 18),
                intArrayOf(2, 21, 31),
                intArrayOf(18, 43, 31),
                intArrayOf(7, 1, 11),
                intArrayOf(25, 23, 24),
                intArrayOf(24, 0, 21),
                intArrayOf(2, 1, 38),
                intArrayOf(20, 31, 27),
                intArrayOf(8, 38, 50),
                intArrayOf(23, 16, 33),
                intArrayOf(22, 28, 19),
                intArrayOf(48, 17, 8),
                intArrayOf(22, 6, 22),
                intArrayOf(4, 3, 43),
                intArrayOf(35, 4, 40),
                intArrayOf(32, 7, 8),
                intArrayOf(46, 37, 49),
                intArrayOf(39, 24, 24),
                intArrayOf(36, 9, 25),
                intArrayOf(39, 34, 22),
                intArrayOf(10, 28, 24),
                intArrayOf(36, 8, 21),
                intArrayOf(23, 30, 36),
                intArrayOf(6, 0, 27),
                intArrayOf(35, 39, 47),
                intArrayOf(14, 40, 30),
                intArrayOf(16, 24, 32),
                intArrayOf(1, 22, 13),
                intArrayOf(0, 40, 32),
                intArrayOf(20, 15, 48),
                intArrayOf(28, 16, 2),
                intArrayOf(16, 29, 42),
                intArrayOf(24, 19, 1),
                intArrayOf(32, 31, 11),
                intArrayOf(4, 29, 4),
                intArrayOf(35, 39, 16),
                intArrayOf(46, 12, 38),
                intArrayOf(22, 48, 49),
                intArrayOf(28, 12, 47),
                intArrayOf(0, 6, 22),
                intArrayOf(39, 44, 14),
                intArrayOf(5, 37, 19),
                intArrayOf(43, 33, 33),
                intArrayOf(37, 23, 21),
                intArrayOf(13, 8, 50),
                intArrayOf(36, 16, 30),
                intArrayOf(9, 24, 30),
                intArrayOf(24, 10, 28),
                intArrayOf(12, 42, 11),
                intArrayOf(4, 20, 4),
                intArrayOf(6, 44, 31),
                intArrayOf(15, 17, 39),
                intArrayOf(14, 30, 36),
                intArrayOf(18, 47, 34),
                intArrayOf(18, 30, 28),
                intArrayOf(16, 40, 50),
                intArrayOf(30, 3, 24),
                intArrayOf(6, 4, 41),
                intArrayOf(7, 11, 6),
                intArrayOf(10, 20, 20),
                intArrayOf(16, 43, 18),
                intArrayOf(13, 27, 14),
                intArrayOf(18, 1, 33),
                intArrayOf(24, 48, 45),
                intArrayOf(2, 48, 21),
                intArrayOf(30, 18, 32),
                intArrayOf(18, 42, 17),
                intArrayOf(42, 15, 36),
                intArrayOf(36, 7, 6),
                intArrayOf(35, 31, 12),
                intArrayOf(13, 31, 45),
                intArrayOf(7, 8, 8),
                intArrayOf(39, 29, 12),
                intArrayOf(20, 39, 43),
                intArrayOf(14, 42, 5),
                intArrayOf(6, 32, 44),
                intArrayOf(11, 4, 21),
                intArrayOf(34, 25, 26),
                intArrayOf(28, 29, 28),
                intArrayOf(45, 4, 7),
                intArrayOf(12, 2, 5),
                intArrayOf(27, 41, 44),
                intArrayOf(44, 34, 11),
                intArrayOf(7, 11, 37),
                intArrayOf(31, 16, 13),
                intArrayOf(47, 13, 14),
                intArrayOf(5, 34, 6),
                intArrayOf(41, 11, 49),
                intArrayOf(48, 11, 20),
                intArrayOf(33, 42, 2),
                intArrayOf(18, 5, 21),
                intArrayOf(4, 19, 9),
                intArrayOf(38, 46, 26),
                intArrayOf(26, 17, 13),
                intArrayOf(19, 41, 49),
                intArrayOf(11, 38, 22),
                intArrayOf(2, 21, 11),
                intArrayOf(13, 49, 14),
                intArrayOf(21, 9, 36),
                intArrayOf(8, 14, 27),
                intArrayOf(45, 9, 14),
                intArrayOf(1, 2, 1),
                intArrayOf(38, 4, 35),
                intArrayOf(1, 48, 39),
                intArrayOf(1, 18, 50),
                intArrayOf(3, 5, 4),
                intArrayOf(47, 3, 37),
                intArrayOf(6, 26, 31),
                intArrayOf(49, 22, 46),
                intArrayOf(14, 19, 49),
                intArrayOf(11, 33, 34),
                intArrayOf(17, 7, 25),
                intArrayOf(30, 14, 31),
                intArrayOf(18, 14, 45),
                intArrayOf(29, 2, 45),
                intArrayOf(14, 35, 49),
                intArrayOf(10, 37, 28),
                intArrayOf(12, 15, 20),
                intArrayOf(34, 0, 45),
                intArrayOf(42, 7, 37),
                intArrayOf(41, 15, 16),
                intArrayOf(47, 12, 26),
                intArrayOf(0, 30, 11),
                intArrayOf(10, 1, 22),
                intArrayOf(16, 36, 16),
                intArrayOf(24, 32, 10),
                intArrayOf(24, 22, 50),
                intArrayOf(35, 4, 13),
                intArrayOf(45, 10, 41),
                intArrayOf(17, 36, 23),
                intArrayOf(2, 48, 14),
                intArrayOf(33, 11, 30),
                intArrayOf(6, 22, 27),
                intArrayOf(42, 14, 35),
                intArrayOf(22, 4, 17),
                intArrayOf(25, 35, 26),
                intArrayOf(49, 18, 13),
                intArrayOf(16, 25, 35),
                intArrayOf(41, 20, 12),
                intArrayOf(2, 30, 29),
                intArrayOf(12, 11, 12),
                intArrayOf(47, 3, 13),
                intArrayOf(2, 10, 34),
                intArrayOf(13, 29, 15),
                intArrayOf(37, 34, 44),
                intArrayOf(8, 33, 21),
                intArrayOf(42, 37, 49),
                intArrayOf(48, 26, 31),
                intArrayOf(18, 44, 23),
                intArrayOf(22, 8, 18),
                intArrayOf(34, 37, 30),
                intArrayOf(41, 40, 49),
                intArrayOf(17, 41, 11),
                intArrayOf(1, 23, 32),
                intArrayOf(5, 1, 48),
                intArrayOf(49, 23, 50),
                intArrayOf(40, 49, 32),
                intArrayOf(25, 46, 6),
                intArrayOf(43, 30, 37),
                intArrayOf(20, 3, 13),
                intArrayOf(5, 46, 49),
                intArrayOf(34, 10, 35),
                intArrayOf(42, 48, 38),
                intArrayOf(40, 16, 31),
                intArrayOf(49, 43, 16),
                intArrayOf(24, 12, 16),
                intArrayOf(2, 0, 36),
                intArrayOf(49, 29, 10),
                intArrayOf(16, 37, 37),
                intArrayOf(22, 45, 44),
                intArrayOf(42, 21, 35),
                intArrayOf(39, 33, 14),
                intArrayOf(9, 3, 2),
                intArrayOf(42, 34, 19),
                intArrayOf(35, 46, 24),
                intArrayOf(36, 30, 44),
                intArrayOf(17, 2, 34),
                intArrayOf(4, 30, 29),
                intArrayOf(28, 15, 28),
                intArrayOf(9, 8, 44),
                intArrayOf(36, 42, 46),
                intArrayOf(9, 14, 41),
                intArrayOf(40, 23, 3),
                intArrayOf(41, 9, 23),
                intArrayOf(42, 47, 29),
                intArrayOf(2, 22, 48),
                intArrayOf(22, 44, 32),
                intArrayOf(15, 7, 46),
                intArrayOf(11, 28, 4),
                intArrayOf(28, 7, 47),
                intArrayOf(14, 39, 21),
                intArrayOf(2, 7, 6),
                intArrayOf(1, 9, 12),
                intArrayOf(25, 16, 15),
                intArrayOf(44, 10, 48),
                intArrayOf(46, 15, 3),
                intArrayOf(7, 3, 32),
                intArrayOf(44, 30, 18),
                intArrayOf(27, 10, 46),
                intArrayOf(11, 4, 28),
                intArrayOf(49, 15, 15),
                intArrayOf(49, 36, 10),
                intArrayOf(36, 15, 39),
                intArrayOf(16, 36, 21),
                intArrayOf(11, 21, 29),
                intArrayOf(29, 12, 17),
                intArrayOf(29, 31, 24),
                intArrayOf(32, 47, 13),
                intArrayOf(3, 4, 17),
                intArrayOf(31, 18, 13),
                intArrayOf(11, 33, 6),
                intArrayOf(7, 27, 50),
                intArrayOf(7, 3, 40),
                intArrayOf(24, 40, 41),
                intArrayOf(47, 25, 42),
                intArrayOf(20, 38, 21),
                intArrayOf(42, 25, 10),
                intArrayOf(20, 0, 42),
                intArrayOf(31, 19, 6),
                intArrayOf(31, 8, 29),
                intArrayOf(3, 19, 10),
                intArrayOf(9, 32, 50),
                intArrayOf(15, 17, 40),
                intArrayOf(12, 9, 42),
                intArrayOf(16, 28, 25),
                intArrayOf(26, 10, 20),
                intArrayOf(19, 0, 42),
                intArrayOf(10, 48, 27),
                intArrayOf(47, 1, 33),
                intArrayOf(36, 29, 18),
                intArrayOf(38, 36, 38),
                intArrayOf(0, 41, 31),
                intArrayOf(17, 27, 23),
                intArrayOf(39, 8, 30),
                intArrayOf(47, 37, 5),
                intArrayOf(39, 1, 50),
                intArrayOf(39, 25, 21),
                intArrayOf(13, 35, 22),
                intArrayOf(0, 22, 8),
                intArrayOf(3, 1, 39),
                intArrayOf(11, 7, 3),
                intArrayOf(12, 44, 28),
                intArrayOf(33, 13, 27),
                intArrayOf(30, 16, 7),
                intArrayOf(36, 45, 31),
                intArrayOf(33, 32, 42),
                intArrayOf(33, 1, 15),
                intArrayOf(39, 3, 23),
                intArrayOf(48, 6, 12),
                intArrayOf(24, 49, 5),
                intArrayOf(13, 46, 22),
                intArrayOf(43, 23, 26),
                intArrayOf(24, 15, 46),
                intArrayOf(24, 43, 14),
                intArrayOf(0, 14, 31),
                intArrayOf(42, 41, 6),
                intArrayOf(14, 47, 6),
                intArrayOf(36, 39, 6),
                intArrayOf(24, 18, 45),
                intArrayOf(10, 39, 1),
                intArrayOf(17, 25, 22),
                intArrayOf(36, 23, 23),
                intArrayOf(10, 23, 42),
                intArrayOf(40, 33, 41),
                intArrayOf(41, 28, 13),
                intArrayOf(25, 1, 1),
                intArrayOf(10, 45, 19),
                intArrayOf(40, 2, 42),
                intArrayOf(14, 42, 40),
                intArrayOf(13, 37, 24),
                intArrayOf(29, 38, 32),
                intArrayOf(47, 11, 35),
                intArrayOf(24, 4, 45),
                intArrayOf(37, 40, 7),
                intArrayOf(29, 45, 37),
                intArrayOf(13, 44, 49)
            ), intArrayOf(
                190,
                843,
                824,
                838,
                336,
                528,
                395,
                301,
                902,
                169,
                729,
                254,
                2,
                463,
                15,
                649,
                865,
                840,
                198,
                789,
                232,
                516,
                699,
                157,
                608,
                893,
                40,
                87,
                615,
                294,
                214,
                66,
                313,
                103,
                847,
                326,
                501,
                1000,
                65,
                35,
                622,
                905,
                15,
                571,
                808,
                444,
                866,
                11,
                182,
                657
            )
        ).also { println("${it} should be $it") }
    }.also { println("Time cost: ${it}ms") }
}